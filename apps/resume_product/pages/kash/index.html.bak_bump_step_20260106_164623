<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Resume Product - KASH</title>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { bootStepPage } from "/apps/resume_product/pages/_step_page.js?v=9999";
    import { loadDB, setActive } from "/core/storage/resume_db.js";
    import { mountStepForm } from "/core/ui/step_form_v0_2.js?v=2";

    // 通用壳（按钮会读 window.__STEP_PAYLOAD__）
    bootStepPage({ title:"Resume Product — KASH", stepId:"claimed_kash", writeFnName:"writeKashDummy" });

    // 统一表单 + payload + 自动保存
 mountStepForm({
  appId: "app",
  title: "KASH（四维度）",
  desc: "说明：输入后将自动保存（不跳页）。进入下一步仍可用上方“写入/保存并进入下一步”。",
  fields: [
    { id: "k_k", label: "K（Knowledge）", type: "textarea", key: "k", rows: 4, placeholder: "知识/理解：你掌握了什么？" },
    { id: "k_a", label: "A（Ability）",   type: "textarea", key: "a", rows: 4, placeholder: "能力/方法：你能做到什么？" },
    { id: "k_s", label: "S（Skill）",     type: "textarea", key: "s", rows: 4, placeholder: "技能/工具：你熟练的技能是什么？" },
    { id: "k_h", label: "H（Habit）",     type: "textarea", key: "h", rows: 4, placeholder: "习惯/风格：你稳定的工作习惯？" },
    { id: "k_note", label: "备注",        type: "textarea", key: "note", rows: 4, placeholder: "补充说明（可选）" },
  ],

  loadDB,
  setActive,
  writerName: "writeKashDummy",
  setActiveMap: { claimed_kash_id: "RET_ID" },

  // 回填：读取 claimed_kash[active.claimed_kash_id].payload
  fillFromDB: (db) => {
    const kid = db?.active?.claimed_kash_id || null;
    const row = kid ? db?.claimed_kash?.[kid] : null;
    const p = row?.payload || row || {};
    return {
      k: p.k || "",
      a: p.a || "",
      s: p.s || "",
      h: p.h || "",
      note: p.note || "",
    };
  },

  // 同步：写回 window.__STEP_PAYLOAD__（_step_page 主按钮会读这个）
  buildPayload: () => {
    const v = (id) => (document.getElementById(id)?.value || "").toString();
    return {
      k: v("k_k"),
      a: v("k_a"),
      s: v("k_s"),
      h: v("k_h"),
      note: v("k_note"),
    };
  },
});

</script>
</body>
</html>