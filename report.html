<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY GIFT å¤©èµ‹ç‰¹è´¨ç»“æ„è§£ææŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        #gapRadarChart {
    height: 300px !important;
}
        body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); overflow: hidden; min-height: 800px;}
        
        /* å¤´éƒ¨ */
        .header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #1B2A41 0%, #2E4A62 100%); color: white; }
        .header h1 { margin: 0; font-size: 24px; }
        
        /* å¯¼èˆª Tab */
        .tabs { display: flex; flex-wrap: wrap; justify-content: center; background: #fff; border-bottom: 1px solid #eee; padding: 10px; gap: 10px;}
        .tab-btn { padding: 8px 20px; border: 1px solid #ddd; border-radius: 20px; background: #fff; cursor: pointer; color: #666; font-size: 14px; transition: all 0.2s; }
        .tab-btn.active { background: #2E4A62; color: #fff; border-color: #2E4A62; font-weight: bold; }
        
        /* å†…å®¹åŒºåŸŸ */
        .tab-content { display: none; padding: 30px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-box { position: relative; height: 300px; width: 100%; margin: 20px auto; }
        
        /* æ¨¡å—æ ‡é¢˜ */
        .module-title { border-left: 5px solid #4EA5A6; padding-left: 15px; margin-bottom: 25px; color: #1B2A41; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>MY GIFT å¤©èµ‹ç‰¹è´¨ç»“æ„è§£ææŠ¥å‘Š</h1>
        <p style="opacity: 0.8; font-size: 14px; margin-top: 10px;">è§£ç ä½ çš„å†…åœ¨é©±åŠ¨åŠ›ä¸æ½œèƒ½ç»“æ„</p>
    </div>

    <div class="tabs" id="tab-nav">
        <button class="tab-btn" onclick="switchTab('m')">1. åŠ¨æœº M</button>
        <button class="tab-btn" onclick="switchTab('t')">2. ç‰¹è´¨ T</button>
        <button class="tab-btn" onclick="switchTab('v')">3. ä»·å€¼è§‚ V</button>
        <button class="tab-btn" onclick="switchTab('r')">4. ç°å® R</button>
        <button class="tab-btn" onclick="switchTab('gap')">5. å·®è· Î”</button>
        <button class="tab-btn" onclick="switchTab('synthesis')">6. ç»¼åˆæ€»ç»“</button>
        <button class="tab-btn" onclick="switchTab('iceberg')">7. å†°å±±å…¨æ™¯</button>
    </div>
    <!-- ç»¼åˆ Summary é¡¶éƒ¨æ€»è§ˆ -->
    <div id="summary-content"></div>
    
    <div id="tab-m" class="tab-content">
        <h2 class="module-title">æ ¸å¿ƒåŠ¨æœº (Motivation)</h2>
        <div id="m-content">
            </div>
    </div>

    <div id="tab-t" class="tab-content">
        <h2 class="module-title">æ€§æ ¼ç‰¹è´¨ (Traits)</h2>
        <div class="chart-box">
            <canvas id="bigFiveRadarChart"></canvas>
        </div>
        <div id="t-content">
            </div>
    </div>

    <div id="tab-v" class="tab-content">
        <h2 class="module-title">ç†æƒ³ä»·å€¼è§‚ (Values)</h2>
        <div class="chart-box">
            <canvas id="vBarChart"></canvas>
        </div>
        <div id="v-content"></div>
    </div>

    <div id="tab-r" class="tab-content">
        <h2 class="module-title">ç°å®æ»¡æ„åº¦ (Reality)</h2>
        <div class="chart-box">
            <canvas id="rBarChart"></canvas>
        </div>
        <div id="r-content"></div>
    </div>

    <div id="tab-gap" class="tab-content">
        <h2 class="module-title">ç†æƒ³ä¸ç°å®å·®è· (Gap Analysis)</h2>
        <div class="chart-box">
            <canvas id="gapRadarChart" height="300"></canvas>
        </div>
        <div id="gap-text-analysis"></div>
        <div id="gap-content"></div>
    </div>

    <div id="tab-synthesis" class="tab-content">
  <h2 class="module-title">ç»¼åˆè¯Šæ–­ä¸è¡ŒåŠ¨å»ºè®®</h2>

  <!-- 1. å†°å±±æ€»å›¾ï¼ˆç¼©ç•¥ç‰ˆï¼‰ -->
  <div class="chart-box" style="max-width:420px;margin-bottom:24px;">
    <canvas id="synIcebergChart" height="260"></canvas>
  </div>

  <!-- 2. æ¨¡å¼ç±»å‹æ ‡é¢˜è¡Œ -->
  <p id="synthesis-mode-line"
     style="font-size:14px;color:#555;margin:0 0 24px;">
    æ¨¡å¼ç±»å‹ï¼ˆ<span id="synthesis-mode-label">åŠ è½½ä¸­â€¦</span>ï¼‰
  </p>

  <!-- 3. ç»“æ„åŒ–æ€»ç»“å†…å®¹ -->
  <div id="synthesis-content"></div>
  <!-- KASH èµ·ç‚¹å»ºè®®å¡ç‰‡å®¹å™¨ -->
<div id="kash-entry-area" style="margin-top:16px;"></div>
</div>
    
    <div id="tab-iceberg" class="tab-content">
        <h2 class="module-title">å†°å±±ç»“æ„å…¨æ™¯å›¾</h2>
        <div style="width: 100%; height: 500px; background: #fff; border-radius: 8px;">
            <canvas id="icebergChart"></canvas>
        </div>
    </div>

</div>

<script type="module" src="/report_renderer.js"></script>

<script>
    // ç®€å•çš„ Tab åˆ‡æ¢é€»è¾‘ (å…¨å±€å‡½æ•°ï¼Œæ–¹ä¾¿ HTML è°ƒç”¨)
    function switchTab(tabName) {
        // 1. éšè—æ‰€æœ‰å†…å®¹
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        // 2. æ˜¾ç¤ºç›®æ ‡å†…å®¹
        const target = document.getElementById('tab-' + tabName);
        if (target) target.classList.add('active');
        
        // 3. æŒ‰é’®é«˜äº®
        // ç®€å•ç²—æš´åœ°æ ¹æ®é¡ºåºæˆ–æ–‡å­—åŒ¹é…ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
        const btns = document.querySelectorAll('.tab-btn');
        // æ ¹æ® tabName æ˜ å°„ç´¢å¼• (m->0, t->1 ...)
        const map = {'m':0, 't':1, 'v':2, 'r':3, 'gap':4, 'synthesis':5, 'iceberg':6};
        if (btns[map[tabName]]) btns[map[tabName]].classList.add('active');

        // 4. æ›´æ–° URLï¼Œæ–¹ä¾¿åˆ·æ–°åè¿˜åœ¨è¿™ä¸€é¡µ
        const url = new URL(window.location);
        url.searchParams.set('tab', tabName);
        window.history.pushState({}, '', url);
    }

    // åˆå§‹åŒ–ï¼šè¯»å– URL å‚æ•°å¹¶åˆ‡æ¢
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        const tab = params.get('tab') || 'm';
        switchTab(tab);
    };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    // å¯¼å‡º PDF çš„é€»è¾‘
    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const content = document.body; // æˆ–è€…æŒ‡å®šå…·ä½“çš„æŠ¥å‘Šå®¹å™¨ ID
        const btn = document.getElementById('exportBtn');
        
        // å¯¼å‡ºå‰éšè—æŒ‰é’®
        if(btn) btn.style.display = 'none';

        const canvas = await html2canvas(content, {
            scale: 2, // æé«˜æ¸…æ™°åº¦
            useCORS: true
        });

        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save('MY_GIFT_æ·±åº¦è§£ææŠ¥å‘Š.pdf');

        // æ¢å¤æŒ‰é’®
        if(btn) btn.style.display = 'block';
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<button id="exportBtn" onclick="exportPDF()" style="
    position: fixed; 
    top: 20px; 
    right: 20px; 
    z-index: 9999;
    padding: 12px 24px; 
    background: #2c3e50; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    font-family: sans-serif;">
    ğŸ“¥ ä¸‹è½½æŠ¥å‘Š (PDF)
</button>

<script>
    async function exportPDF() {
        const btn = document.getElementById('exportBtn');
        // 1. å¯¼å‡ºå‰å…ˆéšè—æŒ‰é’®ï¼Œä¸ç„¶æŒ‰é’®ä¹Ÿä¼šè¢«å°åœ¨ PDF é‡Œ
        btn.style.display = 'none';
        
        // æç¤ºç”¨æˆ·ç¨ç­‰
        const originalText = btn.innerText;
        
        try {
            const { jsPDF } = window.jspdf;
            // æ•æ‰æ•´ä¸ªç½‘é¡µå†…å®¹
            const canvas = await html2canvas(document.body, {
                scale: 2, // æ¸…æ™°åº¦ 2 å€
                useCORS: true,
                logging: false
            });

            // è®¡ç®— A4 çº¸æ¯”ä¾‹
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

            // ç”Ÿæˆ PDF
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save('MY_GIFT_æ·±åº¦è§£ææŠ¥å‘Š.pdf');
            
        } catch (err) {
            console.error("PDF ç”Ÿæˆå¤±è´¥:", err);
            alert("å¯¼å‡ºå¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„'æ‰“å°->å¦å­˜ä¸ºPDF'åŠŸèƒ½");
        } finally {
            // æ¢å¤æŒ‰é’®æ˜¾ç¤º
            btn.style.display = 'block';
        }
    }
</script>
</body>
</html>